!function(e,r){"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?module.exports=r():e.TappySystemFamily=r()}(this,function(){function o(e,r){for(var t=[],o=0;o<r.length;o++){var n=r[o];"function"!=typeof e[n]&&t.push(n)}return t}function t(e,r){var t=o(e,r);return!(null===t||0<t.length)}function n(e,t){return e.length==t.length&&e.every(function(e,r){return e===t[r]})}function e(r){return function(e){if("object"!=typeof e||null===e)throw new Error("Command passed to check type must be an object implementing: "+a.join(", "));if(t(e,a))return n(e.getCommandFamily(),s)&&e.getCommandCode()===r;throw new Error("Command passed to check type must also implement: "+o(e,a).join(", "))}}function r(e){return{getCommandFamily:function(){return s},getCommandCode:function(){return e},getPayload:function(){return[]},parsePayload:function(){}}}function i(){}var s=new Uint8Array([0,0]),a=["getCommandFamily","getCommandCode","getPayload"],p={},m=254,y=255,u=2,c=253,l=1;i.prototype=r(y),i.isTypeOf=e(y),p.GetFirmwareVersion=i;function h(){}h.prototype=r(m),h.isTypeOf=e(m),p.GetHardwareVersion=h;function f(){}f.prototype=r(c),f.isTypeOf=e(c),p.Ping=f;function d(){}d.prototype=r(u),d.isTypeOf=e(u),p.GetBatteryLevel=d;function g(){arguments.length<2?(this.param=1,this.value=0):(this.param=arguments[0],this.value=arguments[1])}g.prototype=r(l),g.isTypeOf=e(l),g.prototype.getPayload=function(){return[this.param,this.value]},g.prototype.parsePayload=function(e){if(e.length<2)throw new Error("Set config payloads must be at least two bytes");this.param=e[0],this.value=e[1]},g.prototype.getParam=function(){return this.param},g.prototype.getValue=function(){return this.value},g.prototype.setParam=function(e){this.param=e},g.prototype.setValue=function(e){this.value=e},p.SetConfigItem=g;var V={},w=7,C=3,v=6,E=5,P=8,S=1,M=2,b=4,F=253,j=127;V.ConfigItemSuccess=function(){},V.ConfigItemSuccess.prototype=r(w),V.ConfigItemSuccess.isTypeOf=e(w),V.CrcMismatch=function(){},V.CrcMismatch.prototype=r(C),V.CrcMismatch.isTypeOf=e(C),V.FirmwareVersion=function(){arguments.length<2?(this.majorVersion=0,this.minorVersion=0):(this.majorVersion=arguments[0],this.minorVersion=arguments[1])},V.FirmwareVersion.prototype=r(v),V.FirmwareVersion.isTypeOf=e(v),V.FirmwareVersion.prototype.getPayload=function(){return new Uint8Array([this.majorVersion,this.minorVersion])},V.FirmwareVersion.prototype.parsePayload=function(e){if(e.length<2)throw new Error("Firmware version responses must be at least 2 bytes");this.majorVersion=e[0],this.minorVersion=e[1]},V.FirmwareVersion.prototype.getMajorVersion=function(){return this.majorVersion},V.FirmwareVersion.prototype.getMinorVersion=function(){return this.minorVersion},V.FirmwareVersion.prototype.setMajorVersion=function(e){this.majorVersion=e},V.FirmwareVersion.prototype.setMinorVersion=function(e){this.minorVersion=e},V.BatteryLevel=function(){this.level=arguments.length<1?0:arguments[0]},V.BatteryLevel.prototype=r(P),V.BatteryLevel.isTypeOf=e(P),V.BatteryLevel.prototype.getPayload=function(){return new Uint8Array([this.level])},V.BatteryLevel.prototype.parsePayload=function(e){this.level=e[0]},V.BatteryLevel.prototype.getBatteryLevel=function(){return this.level},V.BatteryLevel.prototype.setBatteryLevel=function(e){this.level=e},V.HardwareVersion=function(){arguments.length<2?(this.majorVersion=0,this.minorVersion=0):(this.majorVersion=arguments[0],this.minorVersion=arguments[1])},V.HardwareVersion.prototype=r(E),V.HardwareVersion.isTypeOf=e(E),V.HardwareVersion.prototype.getPayload=function(){return new Uint8Array([this.majorVersion,this.minorVersion])},V.HardwareVersion.prototype.parsePayload=function(e){if(e.length<2)throw new Error("Hardware version responses must be at least 2 bytes");this.majorVersion=e[0],this.minorVersion=e[1]},V.HardwareVersion.prototype.getMajorVersion=function(){return this.majorVersion},V.HardwareVersion.prototype.getMinorVersion=function(){return this.minorVersion},V.HardwareVersion.prototype.setMajorVersion=function(e){this.majorVersion=e},V.HardwareVersion.prototype.setMinorVersion=function(e){this.minorVersion=e},V.ImproperMessageFormat=function(){},V.ImproperMessageFormat.prototype=r(S),V.ImproperMessageFormat.isTypeOf=e(S),V.LcsMismatch=function(){},V.LcsMismatch.prototype=r(M),V.LcsMismatch.isTypeOf=e(M),V.LengthMismatch=function(){},V.LengthMismatch.prototype=r(b),V.LengthMismatch.isTypeOf=e(b),V.Ping=function(){},V.Ping.prototype=r(F),V.Ping.isTypeOf=e(F),V.SystemError=function(){arguments.length<3?(this.errorCode=0,this.internalErrorCode=0,this.readerStatus=0,this.message=""):(this.errorCode=arguments[0],this.internalErrorCode=arguments[1],this.readerStatus=arguments[2],this.message=3<arguments.length?arguments[3]:"")},V.SystemError.isTypeOf=e(j),V.SystemError.prototype=r(j),V.SystemError.prototype.getPayload=function(){for(var e=unescape(encodeURIComponent(this.message)),r=[],t=0;t<e.length;t++)r.push(e.charCodeAt(t));var o=new Uint8Array(3+r.length);return o[0]=this.errorCode,o[1]=this.internalErrorCode,o[2]=this.readerStatus,o.set(r,3),o},V.SystemError.prototype.parsePayload=function(e){if(e.length<3)throw new Error("System error payload must be at least 3 bytes");this.errorCode=e[0],this.internalErrorCode=e[1],this.readerStatus=e[2],3<e.length?this.message=String.fromCharCode.apply(null,e.slice(3)):this.message=""},V.SystemError.prototype.getErrorCode=function(){return this.errorCode},V.SystemError.prototype.getInternalErrorCode=function(){return this.internalErrorCode},V.SystemError.prototype.getReaderStatusCode=function(){return this.readerStatus},V.SystemError.prototype.getErrorMessage=function(){return this.message},V.SystemError.prototype.setErrorCode=function(e){this.errorCode=e},V.SystemError.prototype.setInternalErrorCode=function(e){this.internalErrorCode=e},V.SystemError.prototype.setReaderStatusCode=function(e){this.readerStatus=e},V.SystemError.prototype.setErrorMessage=function(e){this.message=e};function L(e){if("object"!=typeof e||null===e)throw new Error("Command passed to resolver must be an object implementing: "+a.join(", "));if(!t(e,a))throw new Error("Error, command passed to resolver must also implement: "+o(e,a).join(", "));return!!n(e.getCommandFamily(),s)}function T(){}return T.prototype.checkFamily=L,T.prototype.validate=function(e){if(L(e))return!0;throw new Error("Resolver doesn't support command's family")},T.prototype.resolveCommand=function(e){var r=null;if(this.validate(e))switch(e.getCommandCode()){case m:(r=new p.GetHardwareVersion).parsePayload(e.getPayload());break;case y:(r=new p.GetFirmwareVersion).parsePayload(e.getPayload());break;case u:(r=new p.GetBatteryLevel).parsePayload(e.getPayload());break;case c:(r=new p.Ping).parsePayload(e.getPayload());break;case l:(r=new p.SetConfigItem).parsePayload(e.getPayload())}return r},T.prototype.resolveResponse=function(e){var r=null;if(this.validate(e)){var t=null;switch(e.getCommandCode()){case w:t=V.ConfigItemSuccess;break;case C:t=V.CrcMismatch;break;case v:t=V.FirmwareVersion;break;case E:t=V.HardwareVersion;break;case P:t=V.BatteryLevel;break;case S:t=V.ImproperMessageFormat;break;case M:t=V.LcsMismatch;break;case b:t=V.LengthMismatch;break;case F:t=V.Ping;break;case j:t=V.SystemError}null!==t&&(r=new t).parsePayload(e.getPayload())}return r},{Commands:p,Responses:V,ErrorCodes:{INVALID_PARAMETER:5,UNSUPPORTED_COMMAND_FAMILY:6,TOO_FEW_PARAMETERS:7},Resolver:T,FamilyCode:s}});