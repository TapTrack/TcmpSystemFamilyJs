!function(e,r){"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?module.exports=r():e.TappySystemFamily=r()}(this,function(){var e=new Uint8Array([0,0]),r=function(e,r){for(var t=[],o=0;o<r.length;o++){var n=r[o];"function"!=typeof e[n]&&t.push(n)}return t},t=function(e,t){var o=r(e,t);return!(null===o||o.length>0)},o=function(e,r){return e.length==r.length&&e.every(function(e,t){return e===r[t]})},n=["getCommandFamily","getCommandCode","getPayload"],i={},s={GetHardwareVersion:254,GetFirmwareVersion:255,GetBatteryLevel:2,Ping:253,SetConfig:1},a=function(i){return function(s){if("object"!=typeof s||null===s)throw new Error("Command passed to check type must be an object implementing: "+n.join(", "));if(t(s,n))return o(s.getCommandFamily(),e)&&s.getCommandCode()===i;throw new Error("Command passed to check type must also implement: "+r(s,n).join(", "))}},m=function(r){return{getCommandFamily:function(){return e},getCommandCode:function(){return r},getPayload:function(){return[]},parsePayload:function(){}}},p=function(){};p.prototype=m(s.GetFirmwareVersion),p.isTypeOf=a(s.GetFirmwareVersion),i.GetFirmwareVersion=p;var y=function(){};y.prototype=m(s.GetHardwareVersion),y.isTypeOf=a(s.GetHardwareVersion),i.GetHardwareVersion=y;var c=function(){};c.prototype=m(s.Ping),c.isTypeOf=a(s.Ping),i.Ping=c;var u=function(){};u.prototype=m(s.GetBatteryLevel),u.isTypeOf=a(s.GetBatteryLevel),i.GetBatteryLevel=u;var h=function(){arguments.length<2?(this.param=1,this.value=0):(this.param=arguments[0],this.value=arguments[1])};h.prototype=m(s.SetConfig),h.isTypeOf=a(s.SetConfig),h.prototype.getPayload=function(){return[this.param,this.value]},h.prototype.parsePayload=function(e){if(e.length<2)throw new Error("Set config payloads must be at least two bytes");this.param=e[0],this.value=e[1]},h.prototype.getParam=function(){return this.param},h.prototype.getValue=function(){return this.value},h.prototype.setParam=function(e){this.param=e},h.prototype.setValue=function(e){this.value=e},i.SetConfigItem=h;var l={},f={ConfigItemSuccess:7,CrcMismatch:3,FirmwareVersion:6,HardwareVersion:5,BatteryLevel:8,ImproperMessageFormat:1,LcsMismatch:2,LengthMismatch:4,Ping:253,SystemError:127};l.ConfigItemSuccess=function(){},l.ConfigItemSuccess.prototype=m(f.ConfigItemSuccess),l.ConfigItemSuccess.isTypeOf=a(f.ConfigItemSuccess),l.CrcMismatch=function(){},l.CrcMismatch.prototype=m(f.CrcMismatch),l.CrcMismatch.isTypeOf=a(f.CrcMismatch),l.FirmwareVersion=function(){arguments.length<2?(this.majorVersion=0,this.minorVersion=0):(this.majorVersion=arguments[0],this.minorVersion=arguments[1])},l.FirmwareVersion.prototype=m(f.FirmwareVersion),l.FirmwareVersion.isTypeOf=a(f.FirmwareVersion),l.FirmwareVersion.prototype.getPayload=function(){return new Uint8Array([this.majorVersion,this.minorVersion])},l.FirmwareVersion.prototype.parsePayload=function(e){if(e.length<2)throw new Error("Firmware version responses must be at least 2 bytes");this.majorVersion=e[0],this.minorVersion=e[1]},l.FirmwareVersion.prototype.getMajorVersion=function(){return this.majorVersion},l.FirmwareVersion.prototype.getMinorVersion=function(){return this.minorVersion},l.FirmwareVersion.prototype.setMajorVersion=function(e){this.majorVersion=e},l.FirmwareVersion.prototype.setMinorVersion=function(e){this.minorVersion=e},l.BatteryLevel=function(){arguments.length<1?this.level=0:this.level=arguments[0]},l.BatteryLevel.prototype=m(f.BatteryLevel),l.BatteryLevel.isTypeOf=a(f.BatteryLevel),l.BatteryLevel.prototype.getPayload=function(){return new Uint8Array([this.level])},l.BatteryLevel.prototype.parsePayload=function(e){this.level=e[0]},l.BatteryLevel.prototype.getBatteryLevel=function(){return this.level},l.BatteryLevel.prototype.setBatteryLevel=function(e){this.level=e},l.HardwareVersion=function(){arguments.length<2?(this.majorVersion=0,this.minorVersion=0):(this.majorVersion=arguments[0],this.minorVersion=arguments[1])},l.HardwareVersion.prototype=m(f.HardwareVersion),l.HardwareVersion.isTypeOf=a(f.HardwareVersion),l.HardwareVersion.prototype.getPayload=function(){return new Uint8Array([this.majorVersion,this.minorVersion])},l.HardwareVersion.prototype.parsePayload=function(e){if(e.length<2)throw new Error("Hardware version responses must be at least 2 bytes");this.majorVersion=e[0],this.minorVersion=e[1]},l.HardwareVersion.prototype.getMajorVersion=function(){return this.majorVersion},l.HardwareVersion.prototype.getMinorVersion=function(){return this.minorVersion},l.HardwareVersion.prototype.setMajorVersion=function(e){this.majorVersion=e},l.HardwareVersion.prototype.setMinorVersion=function(e){this.minorVersion=e},l.ImproperMessageFormat=function(){},l.ImproperMessageFormat.prototype=m(f.ImproperMessageFormat),l.ImproperMessageFormat.isTypeOf=a(f.ImproperMessageFormat),l.LcsMismatch=function(){},l.LcsMismatch.prototype=m(f.LcsMismatch),l.LcsMismatch.isTypeOf=a(f.LcsMismatch),l.LengthMismatch=function(){},l.LengthMismatch.prototype=m(f.LengthMismatch),l.LengthMismatch.isTypeOf=a(f.LengthMismatch),l.Ping=function(){},l.Ping.prototype=m(f.Ping),l.Ping.isTypeOf=a(f.Ping),l.SystemError=function(){arguments.length<3?(this.errorCode=0,this.internalErrorCode=0,this.readerStatus=0,this.message=""):(this.errorCode=arguments[0],this.internalErrorCode=arguments[1],this.readerStatus=arguments[2],arguments.length>3?this.message=arguments[3]:this.message="")},l.SystemError.isTypeOf=a(f.SystemError),l.SystemError.prototype=m(f.SystemError),l.SystemError.prototype.getPayload=function(){for(var e=unescape(encodeURIComponent(this.message)),r=[],t=0;t<e.length;t++)r.push(e.charCodeAt(t));var o=new Uint8Array(3+r.length);return o[0]=this.errorCode,o[1]=this.internalErrorCode,o[2]=this.readerStatus,o.set(r,3),o},l.SystemError.prototype.parsePayload=function(e){if(e.length<3)throw new Error("System error payload must be at least 3 bytes");this.errorCode=e[0],this.internalErrorCode=e[1],this.readerStatus=e[2],e.length>3?this.message=String.fromCharCode.apply(null,e.slice(3)):this.message=""},l.SystemError.prototype.getErrorCode=function(){return this.errorCode},l.SystemError.prototype.getInternalErrorCode=function(){return this.internalErrorCode},l.SystemError.prototype.getReaderStatusCode=function(){return this.readerStatus},l.SystemError.prototype.getErrorMessage=function(){return this.message},l.SystemError.prototype.setErrorCode=function(e){this.errorCode=e},l.SystemError.prototype.setInternalErrorCode=function(e){this.internalErrorCode=e},l.SystemError.prototype.setReaderStatusCode=function(e){this.readerStatus=e},l.SystemError.prototype.setErrorMessage=function(e){this.message=e};var d={INVALID_PARAMETER:5,UNSUPPORTED_COMMAND_FAMILY:6,TOO_FEW_PARAMETERS:7},g=function(i){if("object"!=typeof i||null===i)throw new Error("Command passed to resolver must be an object implementing: "+n.join(", "));if(!t(i,n))throw new Error("Error, command passed to resolver must also implement: "+r(i,n).join(", "));return!!o(i.getCommandFamily(),e)},V=function(){};return V.prototype.checkFamily=function(e){return g(e)},V.prototype.validate=function(e){if(g(e))return!0;throw new Error("Resolver doesn't support command's family")},V.prototype.resolveCommand=function(e){var r=null;if(this.validate(e))switch(e.getCommandCode()){case s.GetHardwareVersion:r=new i.GetHardwareVersion,r.parsePayload(e.getPayload());break;case s.GetFirmwareVersion:r=new i.GetFirmwareVersion,r.parsePayload(e.getPayload());break;case s.GetBatteryLevel:r=new i.GetBatteryLevel,r.parsePayload(e.getPayload());break;case s.Ping:r=new i.Ping,r.parsePayload(e.getPayload());break;case s.SetConfig:r=new i.SetConfigItem,r.parsePayload(e.getPayload())}return r},V.prototype.resolveResponse=function(e){var r=null;if(this.validate(e)){var t=null;switch(e.getCommandCode()){case f.ConfigItemSuccess:t=l.ConfigItemSuccess;break;case f.CrcMismatch:t=l.CrcMismatch;break;case f.FirmwareVersion:t=l.FirmwareVersion;break;case f.HardwareVersion:t=l.HardwareVersion;break;case f.BatteryLevel:t=l.BatteryLevel;break;case f.ImproperMessageFormat:t=l.ImproperMessageFormat;break;case f.LcsMismatch:t=l.LcsMismatch;break;case f.LengthMismatch:t=l.LengthMismatch;break;case f.Ping:t=l.Ping;break;case f.SystemError:t=l.SystemError}null!==t&&(r=new t,r.parsePayload(e.getPayload()))}return r},{Commands:i,Responses:l,ErrorCodes:d,Resolver:V,FamilyCode:e}});